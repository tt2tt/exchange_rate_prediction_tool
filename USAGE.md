# USAGE

## ドキュメントの目的
本書は為替予想ツールの基本的な利用方法をまとめた利用者向けガイドです。GUI の操作手順と生成される成果物の所在、よく発生するエラーへの対処方針を記載しています。

## 前提条件
- 対応 OS: Windows 11
- 推奨 Python: 3.11 以上（開発環境では `venv` を推奨）
- 必須ライブラリ: `requirements.txt` の内容（PySide6、pandas、scikit-learn など）
- 入力データ: CSV 形式で以下のカラムを含むこと
  - `Date`, `Open`, `High`, `Low`, `Close`, `MA5`, `MA25`, `MA75`
  - 日本語列名（例: 日付, 始値）もサポートされますが、欠損や無限値が無いことを確認してください。

## 初期セットアップ
開発環境でソースコードから実行する場合は README.md の手順に従って仮想環境を用意し、依存ライブラリをインストールしてください。

```powershell
python -m venv venv
venv\Scripts\activate
python -m pip install --upgrade pip
pip install -r requirements.txt
```

## アプリケーションの起動
### ソースコード版
1. 仮想環境を有効化する。
2. プロジェクトルートで `python app.py` を実行する。
3. PySide6 のウィンドウ「為替予測ツール」が起動したら利用開始可能です。

### ビルド済みバイナリ版
1. CI もしくは `scripts/build_windows_exe.py` の実行で生成される `dist/exchange_rate_prediction_tool.exe` を確認する。
2. `.exe` をダブルクリック、または PowerShell から実行して GUI を起動する。
3. GitHub Actions の `main` ブランチリリースでは同ファイルがアセットとして添付されます。

## GUI 操作手順
1. 「...」ボタンで学習データとなる CSV を選択する。選択したパスは「学習データ」欄に表示されます。
2. 「スプレッド」欄で取引コスト相当の値を設定する（初期値 0.0005、0 より大きい値が必須）。
3. 「実行」ボタンを押すと前処理→特徴量生成→学習→評価→バックテスト→結果出力が順に実行されます。
4. 進捗バーが処理状況を示し、「処理ログ」には各ステップのメッセージが追記されます。
5. 処理完了時に評価・学習・予測・バックテストのサマリーが更新され、ミニチャートに終値・移動平均・シグナルが描画されます。
6. 完了ダイアログが表示されたら成果物を必要に応じて確認してください。

## 出力と保存物
- モデル: `models/latest_model.joblib`
- バックテスト結果 CSV: `backtests/trades.csv`
- ログ: `logs/run_YYYYMMDD_HHMM.txt`（日次ローテーション、保持期間 30 日）
- ミニチャート: UI 内で表示（必要に応じて DataFrame を取得する実装です）

## よくあるエラーと対処
- 必須カラム不足: CSV に必要な列が欠けているとエラーが表示されます。列名を揃えるかエイリアス対応を確認してください。
- データ件数不足: 10 行未満のデータでは学習できません。十分な期間のデータを用意してください。
- 単一クラス問題: 終値の前日比がすべて同値の場合、二値分類できないためスプレッドや期間設定を見直してください。
- CSV 読み込み失敗: 文字コードやフォーマットが不正な場合は pandas が例外を返します。Excel などで UTF-8 CSV として再保存してください。

## 補足情報
- テストや型チェックは `python scripts/run_ci_checks.py` で一括実行できます。
- 運用時の詳細手順は `document/operations/operations_guide.md` を参照してください。
